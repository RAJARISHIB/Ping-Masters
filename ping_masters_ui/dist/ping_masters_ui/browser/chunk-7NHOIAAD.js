import{d as y,e as v,f as _,g as U,h as A,j as I,l as a,n as p,o,p as b,q as S}from"./chunk-ME25THNO.js";import{C as f,a as m,b as u,c as g,r as h,y as w}from"./chunk-RRZ5U6OK.js";var P=class c{auth=f(I);firestore=f(S);user$=new g(e=>_(this.auth,t=>e.next(t),t=>e.error(t))).pipe(h({bufferSize:1,refCount:!0}));async signInWithGoogle(){let e=new y;e.setCustomParameters({prompt:"select_account"});let t=await A(this.auth,e),r=v(t);await this.ensureUserDocument(t.user,r)}async logout(){await U(this.auth)}async needsGetStarted(e){let t=a(this.firestore,"user",e),r=await p(t);if(!r.exists())return!0;let n=r.data()?.wallet_address;return!Array.isArray(n)||n.length===0}async saveGetStartedDetails(e,t){let r=a(this.firestore,"user",e);await o(r,{wallet_address:t.wallet_address,currency:t.currency,mobile_number:t.mobile_number,notification_channels:t.notification_channels},{merge:!0})}async saveWalletAddresses(e,t){let r=new Map;for(let l of t){let k=String(l?.name??"").trim()||"Wallet",d=String(l?.wallet_id??"").trim();d&&r.set(d.toLowerCase(),{name:k,wallet_id:d})}let s=Array.from(r.values()),n=a(this.firestore,"user",e),i=a(this.firestore,"test_users",e);await Promise.all([o(n,{wallet_address:s},{merge:!0}),o(i,{user_id:e,wallet_address:s},{merge:!0})])}async ensureUserDocument(e,t){let r=a(this.firestore,"user",e.uid),s=await p(r),n=this.buildUserDoc(e,t),i=b();if(!s.exists()){await o(r,u(m({},n),{createdAt:i,lastLoginAt:i}));return}await o(r,u(m({},n),{lastLoginAt:i}),{merge:!0})}buildUserDoc(e,t){let r=t?.profile??{},s=this.pickString(r.id),n=this.pickString(r.given_name),i=this.pickString(r.family_name),l=this.pickString(r.name)??e.displayName;return{localId:e.uid,providerId:t?.providerId??null,federatedId:s?`https://accounts.google.com/${s}`:null,email:e.email??null,emailVerified:e.emailVerified,firstName:n??null,lastName:i??null,fullName:l??null,displayName:e.displayName??null,photoUrl:e.photoURL??null}}pickString(e){if(typeof e!="string")return null;let t=e.trim();return t||null}static \u0275fac=function(t){return new(t||c)};static \u0275prov=w({token:c,factory:c.\u0275fac,providedIn:"root"})};export{P as a};
