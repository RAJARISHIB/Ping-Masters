import{a as I}from"./chunk-7NHOIAAD.js";import{b as E}from"./chunk-ME25THNO.js";import{a as q,b as R,c as y,d as j,e as L,g as Q,i as B,j as H,k as K,l as Y,p as J,r as X}from"./chunk-RQADZXT3.js";import{a as Z}from"./chunk-BQXYHFFU.js";import{a as ee}from"./chunk-MP3POCY7.js";import{Aa as l,Ba as x,C as f,E as w,F as S,L as _,Qa as P,S as d,X as D,ab as $,ba as W,bb as U,ca as p,ea as u,fa as A,fb as V,ga as M,gb as z,ha as O,ia as c,j as v,ja as o,ka as r,la as m,p as F,q as N,ra as k,ta as g,va as b,y as T}from"./chunk-RRZ5U6OK.js";var C=class n{http=f(U);baseUrl=ee.apiUrl;createFromFirebase(e){let t=new Set(["email","whatsapp"]),i={user_id:e.user_id,wallet_address:e.wallet_address.map(({name:a,wallet_id:s})=>({name:a,wallet_id:s})),notification_channels:Array.from(new Set(e.notification_channels.filter(a=>t.has(a))))};return this.http.post(`${this.baseUrl}/users/from-firebase`,i)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=T({token:n,factory:n.\u0275fac,providedIn:"root"})};var ae=(n,e)=>e.key;function le(n,e){n&1&&(o(0,"div",27),l(1,"Wallet name is required."),r())}function se(n,e){n&1&&(o(0,"div",27),l(1,"Wallet ID is required."),r())}function de(n,e){if(n&1){let t=k();o(0,"div",13)(1,"div",15)(2,"label",33),l(3,"Wallet name"),r(),m(4,"input",34),p(5,le,2,0,"div",27),r(),o(6,"div",15)(7,"label",33),l(8,"Wallet ID"),r(),m(9,"input",35),p(10,se,2,0,"div",27),r(),o(11,"button",36),g("click",function(){let a=w(t).$index,s=b();return S(s.removeWallet(a))}),l(12," \xD7 "),r()()}if(n&2){let t,i,a=e.$implicit,s=e.$index,h=b();c("formGroupName",s),d(2),c("for","wallet-name-"+s),d(2),c("id","wallet-name-"+s),d(),u((t=a.get("name"))!=null&&t.touched&&((t=a.get("name"))!=null&&t.hasError("required"))?5:-1),d(2),c("for","wallet-id-"+s),d(2),c("id","wallet-id-"+s),d(),u((i=a.get("wallet_id"))!=null&&i.touched&&((i=a.get("wallet_id"))!=null&&i.hasError("required"))?10:-1),d(),c("disabled",h.wallets.length<=1),W("aria-label","Remove wallet "+(s+1))}}function ce(n,e){n&1&&(o(0,"div",37),l(1,"No currencies found."),r())}function pe(n,e){if(n&1&&(o(0,"span",42),l(1),r()),n&2){let t=b().$implicit;d(),x(t.symbol)}}function ue(n,e){if(n&1){let t=k();o(0,"button",39),g("mousedown",function(a){let s=w(t).$implicit,h=b(3);return a.preventDefault(),S(h.selectCurrency(s))}),o(1,"span",40),l(2),r(),o(3,"span",41),l(4),r(),p(5,pe,2,1,"span",42),r()}if(n&2){let t=e.$implicit;d(2),x(t.key),d(2),x(t.value),d(),u(t.symbol?5:-1)}}function me(n,e){if(n&1&&M(0,ue,6,3,"button",38,ae),n&2){let t=b(2);O(t.filteredCurrencies())}}function fe(n,e){if(n&1&&(o(0,"div",19),p(1,ce,2,0,"div",37)(2,me,2,0),r()),n&2){let t=b();d(),u(t.filteredCurrencies().length===0?1:2)}}function ge(n,e){n&1&&(o(0,"div",27),l(1,"Mobile number is required for WhatsApp updates."),r())}function be(n,e){n&1&&(o(0,"div",27),l(1,"Enter a valid mobile number."),r())}function ye(n,e){n&1&&(o(0,"div",28),l(1,"Optional unless WhatsApp updates are enabled."),r())}function _e(n,e){n&1&&(o(0,"div",29),l(1),r()),n&2&&(d(),x(e))}function he(n,e){n&1&&m(0,"span",31)}var te=class n{authService=f(I);router=f(V);fb=f(J);usersApiService=f(C);user$=this.authService.user$;saving=_(!1);error=_(null);currencies=Z.data;currencyOpen=_(!1);currencyQuery=_("");selectedCurrencyKey=_("USD");selectedCurrencyDisplay=P(()=>{let e=this.selectedCurrencyKey(),t=this.currencies.find(i=>i.key===e);return t?this.formatCurrency(t):e});filteredCurrencies=P(()=>{let e=this.currencyQuery().trim().toLowerCase(),t=this.selectedCurrencyDisplay().trim().toLowerCase(),i=e===t?"":e;return i?this.currencies.filter(s=>this.matchesCurrency(s,i)):this.currencies});form=this.fb.group({wallet_address:this.fb.array([this.createWalletGroup()]),currency:this.fb.control("USD",{nonNullable:!0,validators:[y.required]}),mobile_number:this.fb.control("",{validators:[y.pattern(/^\+?[0-9]{8,15}$/)]}),notifyEmail:this.fb.control(!0,{nonNullable:!0}),notifyWhatsapp:this.fb.control(!1,{nonNullable:!0})});constructor(){this.currencyQuery.set(this.selectedCurrencyDisplay()),this.form.controls.notifyWhatsapp.valueChanges.pipe(E()).subscribe(e=>this.updateMobileValidators(e)),this.updateMobileValidators(this.form.controls.notifyWhatsapp.value),this.user$.pipe(N((e,t)=>e?.uid===t?.uid),E()).subscribe(e=>void this.handleUser(e))}get wallets(){return this.form.controls.wallet_address}addWallet(){this.wallets.push(this.createWalletGroup())}removeWallet(e){this.wallets.length<=1||this.wallets.removeAt(e)}onCurrencyFocus(e){this.currencyOpen.set(!0),e.target?.select()}onCurrencyInput(e){this.currencyQuery.set(e),this.currencyOpen.set(!0)}onCurrencyFocusOut(e){let t=e.currentTarget,i=e.relatedTarget;i&&t.contains(i)||(this.currencyOpen.set(!1),this.currencyQuery.set(this.selectedCurrencyDisplay()))}selectCurrency(e){this.selectedCurrencyKey.set(e.key),this.form.controls.currency.setValue(e.key),this.currencyQuery.set(this.selectedCurrencyDisplay()),this.currencyOpen.set(!1)}async submit(){if(!this.saving()&&(this.error.set(null),this.form.markAllAsTouched(),!this.form.invalid)){this.saving.set(!0);try{let e=await v(this.user$.pipe(F(1)));if(!e){await this.router.navigateByUrl("/login");return}let t=this.wallets.controls.map(ne=>{let G=ne,ie=G.controls.name.value.trim(),re=G.controls.wallet_id.value.trim();return{name:ie,wallet_id:re}}),i=this.form.controls.currency.value,a=[];this.form.controls.notifyEmail.value&&a.push("email"),this.form.controls.notifyWhatsapp.value&&a.push("whatsapp");let s=this.form.controls.mobile_number.value??"",h=s.trim()?s.trim():null;await v(this.usersApiService.createFromFirebase({user_id:e.uid,wallet_address:t,notification_channels:a})),await this.authService.saveGetStartedDetails(e.uid,{wallet_address:t,currency:i,mobile_number:h,notification_channels:a}),await this.router.navigateByUrl("/board")}catch(e){this.error.set(this.humanizeError(e))}finally{this.saving.set(!1)}}}async handleUser(e){if(!e){await this.router.navigateByUrl("/login");return}await this.authService.needsGetStarted(e.uid)||await this.router.navigateByUrl("/board")}createWalletGroup(){return this.fb.group({name:this.fb.control("",{nonNullable:!0,validators:[y.required]}),wallet_id:this.fb.control("",{nonNullable:!0,validators:[y.required]})})}updateMobileValidators(e){let t=this.form.controls.mobile_number;e?t.addValidators([y.required]):t.removeValidators([y.required]),t.updateValueAndValidity({emitEvent:!1})}formatCurrency(e){let t=(e.symbol??"").trim();return t?`${e.key} \u2014 ${e.value} (${t})`:`${e.key} \u2014 ${e.value}`}matchesCurrency(e,t){let i=e.key.toLowerCase(),a=e.value.toLowerCase(),s=(e.symbol??"").toLowerCase();return i.includes(t)||a.includes(t)||s.includes(t)}humanizeError(e){return e instanceof $?`Request failed (${e.status}${e.statusText?` ${e.statusText}`:""}).`:e instanceof Error&&e.message?e.message:"Failed to save. Please try again."}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=D({type:n,selectors:[["app-get-started"]],decls:52,vars:7,consts:[[1,"get-started-page"],["role","main","aria-labelledby","title",1,"card"],[1,"header"],[1,"brand"],["aria-hidden","true",1,"brand-mark"],["src","logo.png","alt","",1,"brand-logo"],[1,"brand-name"],["id","title",1,"title"],[1,"subtitle"],[1,"form",3,"ngSubmit","formGroup"],[1,"section"],[1,"section-title"],["formArrayName","wallet_address",1,"wallets"],[1,"wallet-row",3,"formGroupName"],["type","button",1,"link-btn",3,"click"],[1,"field"],["for","currency",1,"label"],[1,"currency-picker",3,"focusout"],["id","currency","type","text","placeholder","Search currency (e.g. USD, US Dollar)","autocomplete","off",1,"input",3,"focus","input","value"],["role","listbox",1,"currency-dropdown"],[1,"checkbox"],["id","notify-email","type","checkbox","formControlName","notifyEmail"],["for","notify-email"],["id","notify-whatsapp","type","checkbox","formControlName","notifyWhatsapp"],["for","notify-whatsapp"],["for","mobile",1,"label"],["id","mobile","type","tel","formControlName","mobile_number","placeholder","e.g. 9876543210","autocomplete","tel",1,"input"],[1,"hint","error"],[1,"hint"],["role","alert",1,"error-banner"],["type","submit",1,"btn","primary",3,"disabled"],["aria-hidden","true",1,"spinner"],["routerLink","/login",1,"back-link"],[1,"label",3,"for"],["type","text","formControlName","name","placeholder","Metamask","autocomplete","off",1,"input",3,"id"],["type","text","formControlName","wallet_id","placeholder","0xabc123...","autocomplete","off",1,"input",3,"id"],["type","button","title","Remove wallet",1,"icon-btn",3,"click","disabled"],[1,"currency-empty"],["type","button","role","option",1,"currency-option"],["type","button","role","option",1,"currency-option",3,"mousedown"],[1,"currency-code"],[1,"currency-name"],[1,"currency-symbol"]],template:function(t,i){if(t&1&&(o(0,"div",0)(1,"section",1)(2,"header",2)(3,"div",3)(4,"div",4),m(5,"img",5),r(),o(6,"div",6),l(7,"Velox"),r()(),o(8,"h1",7),l(9,"Get started"),r(),o(10,"p",8),l(11," Add at least one wallet. You can add more wallets anytime. "),r()(),o(12,"form",9),g("ngSubmit",function(){return i.submit()}),o(13,"div",10)(14,"div",11),l(15,"Wallet details"),r(),o(16,"div",12),M(17,de,13,9,"div",13,A),r(),o(19,"button",14),g("click",function(){return i.addWallet()}),l(20,"+ Add another wallet"),r()(),o(21,"div",10)(22,"div",11),l(23,"Notifications"),r(),o(24,"div",15)(25,"label",16),l(26,"Select currency"),r(),o(27,"div",17),g("focusout",function(s){return i.onCurrencyFocusOut(s)}),o(28,"input",18),g("focus",function(s){return i.onCurrencyFocus(s)})("input",function(s){return i.onCurrencyInput(s.target.value)}),r(),p(29,fe,3,1,"div",19),r()(),o(30,"div",20),m(31,"input",21),o(32,"label",22),l(33,"Receive updates on Email"),r()(),o(34,"div",20),m(35,"input",23),o(36,"label",24),l(37,"Receive updates on WhatsApp"),r()(),o(38,"div",15)(39,"label",25),l(40,"Mobile number"),r(),m(41,"input",26),p(42,ge,2,0,"div",27)(43,be,2,0,"div",27)(44,ye,2,0,"div",28),r()(),p(45,_e,2,1,"div",29),o(46,"button",30)(47,"span"),l(48,"Get started"),r(),p(49,he,1,0,"span",31),r(),o(50,"a",32),l(51,"Back to login"),r()()()()),t&2){let a;d(12),c("formGroup",i.form),d(5),O(i.wallets.controls),d(11),c("value",i.currencyQuery()),d(),u(i.currencyOpen()?29:-1),d(13),u(i.form.controls.mobile_number.touched&&i.form.controls.mobile_number.hasError("required")?42:i.form.controls.mobile_number.touched&&i.form.controls.mobile_number.hasError("pattern")?43:i.form.controls.notifyWhatsapp.value?-1:44),d(3),u((a=i.error())?45:-1,a),d(),c("disabled",i.form.invalid||i.saving()),d(3),u(i.saving()?49:-1)}},dependencies:[X,Q,R,q,j,L,B,Y,H,K,z],styles:["[_nghost-%COMP%]{display:block;min-height:100%}.get-started-page[_ngcontent-%COMP%]{min-height:100vh;display:grid;place-items:center;padding:24px;background:radial-gradient(1200px circle at 20% -10%,rgba(66,133,244,.18),transparent 60%),radial-gradient(900px circle at 100% 10%,rgba(219,68,55,.14),transparent 55%),radial-gradient(900px circle at 0% 100%,rgba(15,157,88,.12),transparent 50%),radial-gradient(900px circle at 80% 110%,rgba(244,180,0,.14),transparent 50%),#f5f6f8}.card[_ngcontent-%COMP%]{width:min(720px,100%);background:#fff;border:1px solid #dadce0;border-radius:20px;padding:36px 36px 28px;box-shadow:0 1px 2px #3c40434d,0 2px 6px #3c404326}.header[_ngcontent-%COMP%]{margin-bottom:18px}.brand[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:18px}.brand-mark[_ngcontent-%COMP%]{width:72px;height:36px;border-radius:10px;display:grid;place-items:center;background:#1a73e814;border:1px solid rgba(26,115,232,.18);overflow:hidden}.brand-logo[_ngcontent-%COMP%]{width:100%;height:100%;display:block;object-fit:contain}.brand-name[_ngcontent-%COMP%]{font-size:14px;font-weight:600;color:#3c4043}.title[_ngcontent-%COMP%]{margin:0 0 8px;font-size:24px;font-weight:500;color:#202124;letter-spacing:-.01em}.subtitle[_ngcontent-%COMP%]{margin:0;font-size:14px;color:#5f6368;line-height:1.4}.form[_ngcontent-%COMP%]{display:grid;gap:18px}.section[_ngcontent-%COMP%]{border:1px solid #e0e3e7;border-radius:16px;padding:16px;background:#fafbfd}.section-title[_ngcontent-%COMP%]{font-size:13px;font-weight:600;color:#3c4043;margin-bottom:12px}.wallets[_ngcontent-%COMP%]{display:grid;gap:12px}.wallet-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr auto;gap:12px;align-items:start;padding:12px;border-radius:14px;background:#fff;border:1px solid #e6e9ee}.field[_ngcontent-%COMP%]{display:grid;gap:6px;min-width:0}.label[_ngcontent-%COMP%]{font-size:12px;color:#5f6368}.input[_ngcontent-%COMP%]{height:40px;border-radius:12px;border:1px solid #dadce0;padding:0 12px;font-size:14px;color:#202124;background:#fff;outline:none}.input[_ngcontent-%COMP%]:focus{border-color:#1a73e8b3;box-shadow:0 0 0 3px #1a73e82e}.currency-picker[_ngcontent-%COMP%]{position:relative}.currency-dropdown[_ngcontent-%COMP%]{position:absolute;inset-inline:0;top:calc(100% + 6px);background:#fff;border:1px solid #dadce0;border-radius:14px;box-shadow:0 12px 28px #3c404333;max-height:260px;overflow:auto;z-index:10}.currency-option[_ngcontent-%COMP%]{width:100%;border:0;background:transparent;cursor:pointer;padding:10px 12px;display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;text-align:left;color:#202124}.currency-option[_ngcontent-%COMP%]:hover, .currency-option[_ngcontent-%COMP%]:focus-visible{background:#f8f9fa;outline:none}.currency-code[_ngcontent-%COMP%]{font-weight:700;color:#3c4043;font-variant-numeric:tabular-nums}.currency-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.currency-symbol[_ngcontent-%COMP%]{color:#5f6368}.currency-empty[_ngcontent-%COMP%]{padding:10px 12px;font-size:13px;color:#5f6368}.hint[_ngcontent-%COMP%]{font-size:12px;color:#5f6368}.hint.error[_ngcontent-%COMP%]{color:#a50e0e}.icon-btn[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;border:1px solid #dadce0;background:#fff;color:#5f6368;font-size:20px;line-height:0;cursor:pointer}.icon-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#f8f9fa}.icon-btn[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.link-btn[_ngcontent-%COMP%]{margin-top:10px;background:transparent;border:0;color:#1a73e8;font-weight:500;padding:6px 0;cursor:pointer;justify-self:start}.link-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px;color:#202124;font-size:14px}.btn[_ngcontent-%COMP%]{width:100%;height:44px;padding:0 16px;border-radius:999px;border:1px solid #1a73e8;background:#1a73e8;color:#fff;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;position:relative;transition:filter .12s ease,transform .12s ease}.btn[_ngcontent-%COMP%]:hover:not(:disabled){filter:brightness(.97)}.btn[_ngcontent-%COMP%]:active:not(:disabled){transform:translateY(1px)}.btn[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.7}.spinner[_ngcontent-%COMP%]{position:absolute;right:14px;width:16px;height:16px;border-radius:50%;border:2px solid rgba(255,255,255,.35);border-top-color:#fffffff2;animation:_ngcontent-%COMP%_spin .7s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}.error-banner[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;background:#fce8e6;border:1px solid #f6aea9;color:#a50e0e;font-size:13px}.back-link[_ngcontent-%COMP%]{justify-self:center;font-size:13px;color:#1a73e8;text-decoration:none}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}@media (max-width: 720px){.wallet-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.icon-btn[_ngcontent-%COMP%]{justify-self:end}}@media (max-width: 480px){.card[_ngcontent-%COMP%]{border-radius:16px;padding:26px 18px 20px}}"],changeDetection:0})};export{te as GetStartedComponent};
